import 'dart:convert';

import 'package:jaguar_serializer/jaguar_serializer.dart';

import '../common.dart';

part 'message_pmadmin.jser.dart';

class MessagePmAdminAction {
  static const String action = "message/pmadmin";

  static Map<String, dynamic> buildRequest(
      {int uid, int pmid, int plid, String content, String type = "text"}) {
    final bodyData = {
      "action": "send",
      "toUid": "$uid",
      if (pmid != null) "pmid": pmid,
      if (plid != null) "plid": plid,
      "msg": {"type": type, "content": Uri.encodeFull(content)}
    };
    final bodyJson = Uri.encodeFull(json.encode(bodyData));

    return {"json": bodyJson};
  }

  static MessagePmAdminResponse parseResponse(Map<String, dynamic> response) {
    return MessagePmAdminResponseSerializer().fromMap(response);
  }
}

class MessagePmAdminResponse extends MobcentResponse {
  ResponseBody body;
}

class ResponseBody {
  int plid;
  int pmid;
  String sendTime;
}

@GenSerializer()
class MessagePmAdminResponseSerializer
    extends Serializer<MessagePmAdminResponse>
    with _$MessagePmAdminResponseSerializer {}

@GenSerializer()
class ResponseBodySerializer extends Serializer<ResponseBody>
    with _$ResponseBodySerializer {}

/*
%7B%0A%20%20%22toUid%22%20%3A%20%221%22%2C%0A%20%20%22pmid%22%20%3A%203093571%2C%0A%20%20%22msg%22%20%3A%20%7B%0A%20%20%20%20%22content%22%20%3A%20%22%25E5%259B%259E%25E6%258A%25A5%25E8%25BF%2599%25E4%25B8%25AA%25E5%25B0%25B1%25E4%25B8%258D%25E7%2594%25A8%25E8%25AE%25B2%25E4%25BA%2586%25EF%25BC%258C%25E4%25B8%2580%25E6%2596%25B9%25E9%259D%25A2%25E6%2598%25AF%25E6%2588%2591%25E4%25B9%259F%25E4%25B8%258D%25E4%25BC%259A%25E6%258A%258A%25E8%25BF%2599%25E4%25B8%25AA%25E4%25BD%259C%25E4%25B8%25BA%25E4%25B8%2580%25E4%25B8%25AA%25E5%2595%2586%25E4%25B8%259A%25E7%259A%2584%25E9%25A1%25B9%25E7%259B%25AE%25E6%259D%25A5%25E5%2581%259A%25EF%25BC%258C%25E5%2590%258C%25E6%2597%25B6%25E8%25BF%2599%25E4%25B8%25AA%25E9%25A1%25B9%25E7%259B%25AE%25E4%25B9%259F%25E6%2598%25AF%25E5%259C%25A8%25E6%25B5%258B%25E8%25AF%2595%25E9%2587%2587%25E7%2594%25A8%25E6%2596%25B0%25E7%259A%2584%25E6%258A%2580%25E6%259C%25AF%25E6%2596%25B9%25E6%25A1%2588%25E6%259D%25A5%25E5%2581%259A%25E7%259A%2584%25E4%25BA%25A7%25E5%2593%2581%25EF%25BC%258C%25E6%259C%2589%25E8%25AE%25BA%25E5%259D%259B%25E8%25BF%2599%25E9%2587%258C%25E8%25BF%2599%25E4%25B9%2588%25E5%25A4%259A%25E7%259A%2584%25E7%2594%25A8%25E6%2588%25B7%25E5%25B8%25AE%25E7%259D%2580%25E5%25B8%25AE%25E7%259D%2580%25E6%25B5%258B%25E8%25AF%2595%25E5%25B0%25B1%25E7%25AE%2597%25E6%2598%25AF%25E5%259B%259E%25E6%258A%25A5%25E5%2590%25A7%25EF%25BC%258C%25E5%2590%258C%25E6%2597%25B6%25E4%25BB%25A5%25E5%2590%258E%25E4%25B9%259F%25E6%2598%25AF%25E4%25BC%259A%25E6%258B%25BF%25E4%25B8%2580%25E4%25BA%259B%25E4%25B8%25AA%25E4%25BA%25BA%25E7%259A%2584%25E6%2597%25B6%25E9%2597%25B4%25E6%259D%25A5%25E7%25BB%25A7%25E7%25BB%25AD%25E7%25BB%25B4%25E6%258A%25A4%25E3%2580%2582%25E5%2590%258C%25E6%2597%25B6%25E6%259C%25AC%25E8%25BA%25AB%25E7%25BD%2591%25E7%25AB%2599%25E7%25BB%25B4%25E6%258C%2581%25E7%259D%2580%25E8%25BF%2590%25E8%2590%25A5%25E4%25B9%259F%25E6%2598%25AF%25E9%259C%2580%25E8%25A6%2581%25E4%25B8%258D%25E5%25B0%2591%25E7%259A%2584%25E5%25BC%2580%25E9%2594%2580%25EF%25BC%258C%25E5%25B8%258C%25E6%259C%259B%25E5%259C%25A8%25E8%25BF%2599%25E6%2596%25B9%25E9%259D%25A2%25E8%2583%25BD%25E5%25B8%25AE%25E7%259D%2580%25E5%2587%258F%25E5%25B0%2591%25E4%25BA%259B%25E8%25B4%259F%25E6%258B%2585%25EF%25BC%258C%25E8%25AE%25A9%25E8%2583%25BD%25E9%2595%25BF%25E8%25BF%259C%25E8%25BF%2590%25E8%25A1%258C%25E4%25B8%258B%25E5%258E%25BB%25E3%2580%2582%25E4%25BB%258E%25E9%2595%25BF%25E8%25BF%259C%25E8%25A7%2592%25E5%25BA%25A6%25E7%259C%258B%25EF%25BC%258C%25E7%25BD%2591%25E7%25AB%2599%25E5%258F%25AF%25E4%25BB%25A5%25E8%2580%2583%25E8%2599%2591%25E9%2587%2587%25E7%2594%25A8%25E5%25BC%2580%25E6%25BA%2590%25E9%25A1%25B9%25E7%259B%25AE%25E7%259A%2584%25E5%25BD%25A2%25E5%25BC%258F%25E7%25BB%2584%25E7%25BB%2587%25E4%25BA%259B%25E6%259C%258B%25E5%258F%258B%25E4%25BB%25AC%25E6%259D%25A5%25E5%2585%25B1%25E5%2590%258C%25E8%25BF%259B%25E8%25A1%258C%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E7%259A%2584%25E7%25BB%25B4%25E6%258A%25A4%25E5%2592%258C%25E5%258D%2587%25E7%25BA%25A7%25E3%2580%2582%22%2C%0A%20%20%20%20%22type%22%20%3A%20%22text%22%0A%20%20%7D%2C%0A%20%20%22plid%22%20%3A%201492158%2C%0A%20%20%22action%22%20%3A%20%22send%22%0A%7D

{
  "toUid" : "1",
  "pmid" : 3093571,
  "msg" : {
    "content" : "%E5%9B%9E%E6%8A%A5%E8%BF%99%E4%B8%AA%E5%B0%B1%E4%B8%8D%E7%94%A8%E8%AE%B2%E4%BA%86%EF%BC%8C%E4%B8%80%E6%96%B9%E9%9D%A2%E6%98%AF%E6%88%91%E4%B9%9F%E4%B8%8D%E4%BC%9A%E6%8A%8A%E8%BF%99%E4%B8%AA%E4%BD%9C%E4%B8%BA%E4%B8%80%E4%B8%AA%E5%95%86%E4%B8%9A%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%9D%A5%E5%81%9A%EF%BC%8C%E5%90%8C%E6%97%B6%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AE%E4%B9%9F%E6%98%AF%E5%9C%A8%E6%B5%8B%E8%AF%95%E9%87%87%E7%94%A8%E6%96%B0%E7%9A%84%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88%E6%9D%A5%E5%81%9A%E7%9A%84%E4%BA%A7%E5%93%81%EF%BC%8C%E6%9C%89%E8%AE%BA%E5%9D%9B%E8%BF%99%E9%87%8C%E8%BF%99%E4%B9%88%E5%A4%9A%E7%9A%84%E7%94%A8%E6%88%B7%E5%B8%AE%E7%9D%80%E5%B8%AE%E7%9D%80%E6%B5%8B%E8%AF%95%E5%B0%B1%E7%AE%97%E6%98%AF%E5%9B%9E%E6%8A%A5%E5%90%A7%EF%BC%8C%E5%90%8C%E6%97%B6%E4%BB%A5%E5%90%8E%E4%B9%9F%E6%98%AF%E4%BC%9A%E6%8B%BF%E4%B8%80%E4%BA%9B%E4%B8%AA%E4%BA%BA%E7%9A%84%E6%97%B6%E9%97%B4%E6%9D%A5%E7%BB%A7%E7%BB%AD%E7%BB%B4%E6%8A%A4%E3%80%82%E5%90%8C%E6%97%B6%E6%9C%AC%E8%BA%AB%E7%BD%91%E7%AB%99%E7%BB%B4%E6%8C%81%E7%9D%80%E8%BF%90%E8%90%A5%E4%B9%9F%E6%98%AF%E9%9C%80%E8%A6%81%E4%B8%8D%E5%B0%91%E7%9A%84%E5%BC%80%E9%94%80%EF%BC%8C%E5%B8%8C%E6%9C%9B%E5%9C%A8%E8%BF%99%E6%96%B9%E9%9D%A2%E8%83%BD%E5%B8%AE%E7%9D%80%E5%87%8F%E5%B0%91%E4%BA%9B%E8%B4%9F%E6%8B%85%EF%BC%8C%E8%AE%A9%E8%83%BD%E9%95%BF%E8%BF%9C%E8%BF%90%E8%A1%8C%E4%B8%8B%E5%8E%BB%E3%80%82%E4%BB%8E%E9%95%BF%E8%BF%9C%E8%A7%92%E5%BA%A6%E7%9C%8B%EF%BC%8C%E7%BD%91%E7%AB%99%E5%8F%AF%E4%BB%A5%E8%80%83%E8%99%91%E9%87%87%E7%94%A8%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%BD%A2%E5%BC%8F%E7%BB%84%E7%BB%87%E4%BA%9B%E6%9C%8B%E5%8F%8B%E4%BB%AC%E6%9D%A5%E5%85%B1%E5%90%8C%E8%BF%9B%E8%A1%8C%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E7%BB%B4%E6%8A%A4%E5%92%8C%E5%8D%87%E7%BA%A7%E3%80%82",
    "type" : "text"
  },
  "plid" : 1492158,
  "action" : "send"
}
*/

/// message/pmadmin
/// const ACTION_SEND = 'send';
//  const ACTION_DELPLID = 'delplid';
//  const ACTION_DELPMID = 'delpmid';
/// 'action' = 'send';
/// 'toUid' = 0;
/// 'plid' = 0;
/// 'pmid' = 0;
/// 'msg' = 消息内容：send 时设置
/// msg 格式 {'content':'', 'type':'text' or 'image' or 'audio'}
/// private function _transMessage($msg) {
//        $msgString = '';
//        $msg['content'] = rawurldecode($msg['content']);
//        switch ($msg['type']) {
//            case 'text':
//                $msg['content'] = WebUtils::t($msg['content']);
//                $msgString .= WebUtils::transMobcentPhiz($msg['content']);
//                break;
//            case 'image': $msgString .= sprintf('[img]%s[/img]', $msg['content']); break;
//            case 'audio': $msgString .= sprintf('[url=%s]%s[/url]', $msg['content'], 'audio'); break;
//            default: break;
//        }
//        return $msgString;
//    }

var _response = {
  "rs": 1,
  "errcode": "",
  "head": {
    "errCode": "",
    "errInfo": "\u6d88\u606f\u5df2\u53d1\u9001",
    "version": "2.4.0.1",
    "alert": 1
  },
  "body": {
    "externInfo": null,
    "plid": 1492158,
    "pmid": 3093613,
    "sendTime": "1564479006000"
  }
};
